FROM kernsuite/base:3

# Install base requirements
RUN docker-apt-install python-pip
RUN pip install --upgrade pip setuptools
ADD . /code
WORKDIR /code

# Test base install without optional installs works
# Most of the tests will be skipped
RUN pip install .[testing]
RUN py.test -s -vvv /code/africanus

# Test most functionality
# Install kern python-casacore to avoid build dependencies
RUN apt install python-casacore
RUN pip install .[astropy,dask,python-casacore,scipy,testing]
RUN py.test -s -vvv /code/africanus
